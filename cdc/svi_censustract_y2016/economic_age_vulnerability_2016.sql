-- Economic Vulnerability and Age Demographics Analysis by Census Tract - 2016
--
-- Business Purpose:
-- This analysis identifies census tracts with concerning combinations of economic challenges
-- and vulnerable age populations (elderly and youth) to help healthcare organizations and
-- community services prioritize resource allocation and outreach programs.
--
-- The focus is on areas where poverty intersects with high concentrations of elderly
-- or youth populations, as these communities often have unique healthcare needs and
-- may require targeted support services.

WITH economic_indicators AS (
  SELECT 
    state,
    county,
    location,
    e_totpop,
    -- Calculate percentage of population in poverty
    ROUND(ep_pov, 1) as poverty_rate,
    -- Calculate percentage of elderly population
    ROUND(ep_age65, 1) as elderly_rate,
    -- Calculate percentage of youth population
    ROUND(ep_age17, 1) as youth_rate,
    -- Calculate per capita income
    e_pci as per_capita_income
  FROM mimi_ws_1.cdc.svi_censustract_y2016
  WHERE e_totpop >= 100  -- Filter out very small populations
)

SELECT 
  state,
  county,
  location,
  e_totpop as total_population,
  poverty_rate,
  elderly_rate,
  youth_rate,
  per_capita_income,
  -- Flag concerning combinations
  CASE 
    WHEN poverty_rate > 20 AND (elderly_rate > 25 OR youth_rate > 30) THEN 'High Risk'
    WHEN poverty_rate > 20 THEN 'Economic Risk'
    WHEN elderly_rate > 25 OR youth_rate > 30 THEN 'Age Risk'
    ELSE 'Lower Risk'
  END as risk_category
FROM economic_indicators
-- Focus on areas with higher poverty or age-related risks
WHERE poverty_rate > 20 OR elderly_rate > 25 OR youth_rate > 30
ORDER BY 
  state,
  county,
  CASE 
    WHEN poverty_rate > 20 AND (elderly_rate > 25 OR youth_rate > 30) THEN 1
    ELSE 2
  END,
  poverty_rate DESC
LIMIT 1000;

-- How this query works:
-- 1. Creates a CTE with key economic and demographic indicators
-- 2. Calculates risk categories based on combinations of poverty and age demographics
-- 3. Filters for areas with elevated risk in either category
-- 4. Orders results to prioritize highest-risk areas within each state/county
--
-- Assumptions and limitations:
-- - Minimum population threshold of 100 to exclude very small areas
-- - Poverty threshold of 20% based on common definition of high-poverty areas
-- - Age thresholds (25% elderly, 30% youth) chosen to identify significant concentrations
-- - Does not account for trends over time or seasonal variations
--
-- Possible extensions:
-- 1. Add healthcare facility proximity analysis
-- 2. Include unemployment rates and education levels
-- 3. Compare against state/national averages
-- 4. Add year-over-year trend analysis
-- 5. Include analysis of nearby community resources

/*

    - Author: claude-3-5-sonnet-20241022
    - Created At: 2024-11-01T17:13:31.983113
    - Additional Notes: Query uses threshold values (20% poverty, 25% elderly, 30% youth) that may need adjustment based on specific regional contexts or organizational requirements. The 1000-row limit may need modification for comprehensive analysis of larger geographic areas.
    
    */